<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
	template="/templates/menuTemplate.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:p="http://primefaces.org/ui"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core">

	<ui:define name="title">
        سوالات
    </ui:define>
	<ui:define name="content">
		<h:form>

			<p:growl rendered="#{not questionController.anyErrorMessageQueued}" />

			<h:panelGroup rendered="#{empty questionController.toEdit}">

				<p:messages rendered="#{questionController.anyErrorMessageQueued}" />

				<p:dataTable value="#{questionController.list}" var="current"
					emptyMessage="هیچ سوالی تعریف نشده است."
					style="font-family: Tahoma; font-size:10pt">
					<f:facet name="header">
						<h:outputText value="لیست سوالات" />
					</f:facet>
					<p:column headerText="درس" sortBy="#{current.course.toString()}"
						filterBy="#{current.course.toString()}" filterMatchMode="contains">
						#{current.course.toString()}
					</p:column>
					<p:column headerText="سوال">
						<h:outputText value="#{current.questionText}" escape="false" />
					</p:column>
					<p:column headerText="عملیات">
						<h:panelGroup>
							<p:commandButton value="ویرایش" ajax="false"
								action="#{questionController.edit(current)}" icon="editButton"
								iconPos="right" />
							<p:commandButton value="حذف" ajax="true"
								action="#{questionController.setToDelete(current)}"
								oncomplete="dlgRemove.show()" icon="deleteButton"
								iconPos="right" />
						</h:panelGroup>
					</p:column>
					<f:facet name="footer">
						<p:commandButton ajax="false" value="تعریف سوال" style=""
							action="#{questionController.createNew()}" icon="addButton"
							iconPos="right" />
					</f:facet>
				</p:dataTable>

				<p:confirmDialog widgetVar="dlgRemove" severity="alert"
					header="حذف سوال" message="آیا از حذف سوال اطمینان دارید؟"
					position="center" modal="true">
					<p:commandButton value="بله" ajax="false"
						action="#{questionController.remove()}" icon="okButton"
						iconPos="right" />
					<p:commandButton value="خیر" onclick="dlgRemove.hide()"
						style="font-family:Tahoma" icon="cancelButton" iconPos="right" />
				</p:confirmDialog>

			</h:panelGroup>

			<p:fieldset legend="اطلاعات سؤال"
				rendered="#{not empty questionController.toEdit}">
				
				<script>
					$(window).bind("load", function() {
						$("iframe").each(function(idx, frame)
							{
								frame.contentDocument.body.style.fontFamily = 'Tahoma';
								frame.contentDocument.body.style.direction = 'rtl';
							});
						//$("body").css('font-family', 'Tahoma').css('direction', 'rtl');
					});
				</script>						


				<p:messages rendered="#{questionController.anyErrorMessageQueued}" />
				
				<p:focus />
				<h:panelGrid columns="2" cellpadding="10">
				
					<h:outputText value="طراح سؤال : *" id="designers" rendered="#{questionController.designerFieldVisible}"/>
					<p:selectOneMenu value="#{questionController.selectedDesignerId}"
						rendered="#{questionController.designerFieldVisible}" >
						<f:selectItem itemDisabled="true" itemLabel="لطفاً طراح سؤال را انتخاب کنید" itemValue="0"/>
						<f:selectItems value="#{questionController.designerList}" var="designer"
							itemLabel="#{designer.toString()}" itemValue="#{designer.id}" />
						<f:ajax render="courses" listener="#{questionController.updateCourseList}" />
						<p:blockUI block="courses" trigger="designers"/>
					</p:selectOneMenu>
					
					<h:outputText value="درس : *" />
					<h:panelGroup>
						<p:selectOneMenu id="courses" value="#{questionController.selectedCourseId}">
							<f:selectItem itemDisabled="true" itemLabel="#{questionController.courseNoSelectItemText}"
								itemValue="0"/>
							<f:selectItems value="#{questionController.courseList}" var="course"
								itemLabel="#{course.toString()}" itemValue="#{course.id}" />
						</p:selectOneMenu>
					</h:panelGroup>

					<h:outputText value="متن سوال : *" />
					<p:editor value="#{questionController.toEdit.questionText}"
						width="600"/>
						
					<h:outputText value="تصویر سوال : *" />
					<h:panelGroup>
						<p:graphicImage value="#{questionImageLoaderBean.questionImageContent}" >
							<f:param name="questionId" value="#{questionController.toEdit.id}"/>
						</p:graphicImage>
						
						<br/>
						<h:outputText value="#{questionController.toEdit.questionImageFilename}"/>
						<br />
						<p:commandButton ajax="true" value="انتخاب تصویر" onclick="dlgUploadQuestionImage.show()"/>
					</h:panelGroup>
						
					<h:outputText value="متن جواب صحیح  : " />
					<p:editor value="#{questionController.toEdit.answerText}"
						width="600" />
						
					<h:outputText value="تصویر جواب صحیح  : " />
					<h:panelGroup>
						<p:graphicImage value="#{questionImageLoaderBean.answerImageContent}" >
							<f:param name="questionId" value="#{questionController.toEdit.id}"/>
						</p:graphicImage>
						
						<br/>
						<h:outputText value="#{questionController.toEdit.answerImageFilename}"/>
						<br />
						<p:commandButton ajax="true" value="انتخاب تصویر" onclick="dlgUploadAnswerImage.show()"/>
					</h:panelGroup>

					<h:outputText value="متن جواب نادرست اول : " />
					<p:editor value="#{questionController.toEdit.incorrectOption1Text}"
						width="600" />

					<h:outputText value="تصویر جواب نادرست اول : " />
					<h:panelGroup>
						<p:graphicImage value="#{questionImageLoaderBean.incorrectOption1ImageContent}" id="imgAnswer">
							<f:param name="questionId" value="#{questionController.toEdit.id}"/>
						</p:graphicImage>
						
						<br/>
						<h:outputText value="#{questionController.toEdit.incorrectOption1ImageFilename}"/>
						<br />
						<p:commandButton ajax="true" value="انتخاب تصویر" onclick="dlgUploadIncorrectOption1Image.show()"/>
					</h:panelGroup>

					<h:outputText value="متن جواب نادرست دوم  : " />
					<p:editor value="#{questionController.toEdit.incorrectOption2Text}"
						width="600" />
					<h:outputText value="تصویر جواب نادرست دوم  : " />
					<h:panelGroup>
						<p:graphicImage value="#{questionImageLoaderBean.incorrectOption2ImageContent}">
							<f:param name="questionId" value="#{questionController.toEdit.id}"/>
						</p:graphicImage>
						
						<br/>
						<h:outputText value="#{questionController.toEdit.incorrectOption2ImageFilename}"/>
						<br />
						<p:commandButton ajax="true" value="انتخاب تصویر" onclick="dlgUploadIncorrectOption2Image.show()"/>
					</h:panelGroup>

					<h:outputText value="متن جواب نادرست سوم : " />
					<p:editor value="#{questionController.toEdit.incorrectOption3Text}"
						width="600" />
					<h:outputText value="تصویر جواب نادرست سوم : " />
					<h:panelGroup>
						<p:graphicImage value="#{questionImageLoaderBean.incorrectOption3ImageContent}">
							<f:param name="questionId" value="#{questionController.toEdit.id}"/>
						</p:graphicImage>
						
						<br/>
						<h:outputText value="#{questionController.toEdit.incorrectOption3ImageFilename}"/>
						<br />
						<p:commandButton ajax="true" value="انتخاب تصویر" onclick="dlgUploadIncorrectOption3Image.show()"/>
					</h:panelGroup>
						
					<h:outputText value="درجه سختی سؤال : *" />
					<p:selectOneMenu value="#{questionController.questionLevel}">
						<f:selectItem itemLabel="نا مشخص" itemValue="0" itemDisabled="true"/>
						<f:selectItem itemLabel="ساده" itemValue="5"/>
						<f:selectItem itemLabel="متوسط" itemValue="10"/>
						<f:selectItem itemLabel="خوب" itemValue="15"/>
						<f:selectItem itemLabel="مشکل" itemValue="20"/>						
					</p:selectOneMenu>
					
					<h:outputText value="زمان لازم برای پاسخ به سوال (ثانیه): *" />
					<p:inputText value="#{questionController.toEdit.answerTime}" />
				</h:panelGrid>
				<p:commandButton value="ذخیره" ajax="false"
					action="#{questionController.save}" icon="okButton" iconPos="right" />
				<p:commandButton value="لغو" ajax="false" immediate="true"
					action="#{questionController.showList()}" icon="cancelButton"
					iconPos="right" />
			</p:fieldset>

		</h:form>
		
		<p:dialog header="انتخاب تصویر سؤال" widgetVar="dlgUploadQuestionImage" modal="true" width="800" height="200">
			<h:form enctype="multipart/form-data">
				<p:fileUpload fileUploadListener="#{questionController.uploadQuestionPic}"
					cancelLabel="لغو" uploadLabel="ارسال" label="انتخاب فایل"
					allowTypes="/(\.|\/)(gif|jpe?g|png)$/"
					oncomplete="dlgUploadQuestionImage.hide()" />
			</h:form>
		</p:dialog>

		<p:dialog header="انتخاب تصویر جواب" widgetVar="dlgUploadAnswerImage" modal="true"  width="800" height="200">
			<h:form enctype="multipart/form-data">
				<p:fileUpload fileUploadListener="#{questionController.uploadAnswerPic}"
					cancelLabel="لغو" uploadLabel="ارسال" label="انتخاب فایل"
					allowTypes="/(\.|\/)(gif|jpe?g|png)$/"
					oncomplete="dlgUploadAnswerImage.hide()" />
			</h:form>
		</p:dialog>

		<p:dialog header="انتخاب تصویر گزینه نادرست 1" widgetVar="dlgUploadIncorrectOption1Image" modal="true" width="800" height="200">
			<h:form enctype="multipart/form-data">
				<p:fileUpload fileUploadListener="#{questionController.uploadIncorrectOption1Pic}"
					cancelLabel="لغو" uploadLabel="ارسال" label="انتخاب فایل"
					allowTypes="/(\.|\/)(gif|jpe?g|png)$/"
					oncomplete="dlgUploadIncorrectOption1Image.hide()" />
			</h:form>
		</p:dialog>

		<p:dialog header="انتخاب تصویر گزینه نادرست 2" widgetVar="dlgUploadIncorrectOption2Image" modal="true" width="800" height="200">
			<h:form enctype="multipart/form-data">
				<p:fileUpload fileUploadListener="#{questionController.uploadIncorrectOption2Pic}"
					cancelLabel="لغو" uploadLabel="ارسال" label="انتخاب فایل"
					allowTypes="/(\.|\/)(gif|jpe?g|png)$/"
					oncomplete="dlgUploadIncorrectOption2Image.hide()" />
			</h:form>
		</p:dialog>

		<p:dialog header="انتخاب تصویر گزینه نادرست 3" widgetVar="dlgUploadIncorrectOption3Image" modal="true" width="800" height="200">
			<h:form enctype="multipart/form-data">
				<p:fileUpload fileUploadListener="#{questionController.uploadIncorrectOption3Pic}"
					cancelLabel="لغو" uploadLabel="ارسال" label="انتخاب فایل"
					allowTypes="/(\.|\/)(gif|jpe?g|png)$/"
					oncomplete="dlgUploadIncorrectOption3Image.hide()" />
			</h:form>
		</p:dialog>
	</ui:define>

</ui:composition>
